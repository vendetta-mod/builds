"use strict";(()=>{var dt=Object.defineProperty;var E=(e,t)=>{for(var o in t)dt(e,o,{get:t[o],enumerable:!0})};var ce={};E(ce,{after:()=>x,before:()=>mt,instead:()=>pt,unpatchAll:()=>He});var se=["a","b","i"],S=new Map;function Ge(e,t,o,n,r){let i=S.get(t)?.[e];if(!i)return r?Reflect.construct(t[e],o,n):t[e].apply(n,o);for(let d of i.b.values()){let b=d.call(n,o);Array.isArray(b)&&(o=b)}let s=(...d)=>r?Reflect.construct(i.o,d,n):i.o.apply(n,d);for(let d of i.i.values()){let b=s;s=(...A)=>d.call(n,A,b)}let a=s(...o);for(let d of i.a.values())a=d.call(n,o,a)??a;return a}function ae(e,t,o,n){let r=S.get(e),i=r?.[t];return i?.[n].has(o)?(i[n].delete(o),se.every(s=>i[s].size===0)&&(Reflect.defineProperty(e,t,{value:i.o,writable:!0,configurable:!0})||(e[t]=i.o),delete r[t]),Object.keys(r).length==0&&S.delete(e),!0):!1}function He(){for(let[e,t]of S.entries())for(let o in t)for(let n of se)for(let r of t[o]?.[n].keys()??[])ae(e,o,r,n)}var z=e=>(t,o,n,r=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);S.has(o)||S.set(o,{});let i=S.get(o);if(!i[t]){let d=o[t];i[t]={o:d,b:new Map,i:new Map,a:new Map};let b=(v,D,L)=>{let lt=Ge(t,o,D,v,L);return r&&a(),lt},A=new Proxy(d,{apply:(v,D,L)=>b(D,L,!1),construct:(v,D)=>b(d,D,!0),get:(v,D,L)=>D=="toString"?d.toString.bind(d):Reflect.get(v,D,L)});Reflect.defineProperty(o,t,{value:A,configurable:!0,writable:!0})||(o[t]=A)}let s=Symbol(),a=()=>ae(o,t,s,e);return i[t][e].set(s,n),a};var mt=z("b"),pt=z("i"),x=z("a");var Je={...ce};var fe={};E(fe,{filterModules:()=>de,find:()=>M,findAll:()=>pe,findByDisplayName:()=>O,findByDisplayNameAll:()=>ut,findByProps:()=>l,findByPropsAll:()=>ft,findByStoreName:()=>X,modules:()=>me});function Ye(e){Object.defineProperty(window.modules,e,{value:window.modules[e],enumerable:!1,configurable:!0,writable:!0})}for(let e in window.modules){let t=Number(e),o=window.modules[t].publicModule.exports;if(!o||o===window||o.proxygone===null){Ye(t);continue}}var We=e=>Object.values(window.modules).find(t=>t.publicModule.exports?.[e]).publicModule.exports;window.React=We("createElement");var le=We("isMoment"),de=(e,t=!1)=>o=>{let n=[],r=le?.locale();for(let i in e){let s=Number(i),a=e[s].publicModule.exports;if(!e[s].isInitialized)try{__r(s),r&&r!==le.locale()&&le.locale(r)}catch{}if(!a){Ye(s);continue}try{if(a.default&&a.__esModule&&o(a.default)){if(t)return a.default;n.push(a.default)}if(o(a)){if(t)return a;n.push(a)}}catch(d){console.error(`Failed to getModule... ${d.stack||d.toString()}`)}}if(!t)return n},me=window.modules,M=de(me,!0),pe=de(me),Ke=e=>t=>e.every(o=>t[o]!==void 0),ze=(e,t)=>t?o=>o.name===e:o=>o?.default?.name===e,l=(...e)=>M(Ke(e)),ft=(...e)=>pe(Ke(e)),O=(e,t=!0)=>M(ze(e,t)),ut=(e,t=!0)=>pe(ze(e,t)),X=e=>M(t=>t.getName?.()===e);var gt=l("setLogFn").default,ht=new gt("Vendetta"),h=ht;var ve={};E(ve,{AsyncStorage:()=>j,Flux:()=>bt,FluxDispatcher:()=>Z,NavigationNative:()=>be,React:()=>vt,ReactNative:()=>m,assets:()=>U,channels:()=>yt,clipboard:()=>he,constants:()=>ue,i18n:()=>Q,navigation:()=>$,navigationStack:()=>ye,stylesheet:()=>p,toasts:()=>ge,url:()=>q});var ue=l("API_HOST"),yt=l("getVoiceChannelId"),Q=l("Messages"),q=l("openURL"),ge=M(e=>e.open&&e.close&&!e.startDrag&&!e.init&&!e.openReplay&&!e.setAlwaysOnTop),p=l("createThemedStyleSheet"),he=l("setString","getString"),U=l("registerAsset"),$=l("pushLazy"),ye=l("createStackNavigator"),be=l("NavigationContainer"),bt=l("connectStores"),Z=l("_currentDispatchActionType"),vt=l("createElement"),m=l("Text","Image"),j=l("setItem");function _(e){try{he.setString(e)}catch{throw new Error("Failed to set clipboard content.")}}function G(e,t,{walkable:o=[],ignore:n=[],maxDepth:r=100}={}){let i=0;function s(a,d,{walkable:b=[],ignore:A=[]}={}){if(i+=1,!(i>r)){if(typeof d=="string"){if(a.hasOwnProperty(d))return a[d]}else if(d(a))return a;if(!!a){if(Array.isArray(a))for(let F of a){let v=s(F,d,{walkable:b,ignore:A});if(v)return v}else if(typeof a=="object"){for(let F of Object.keys(a))if(!(b!=null&&b.includes(F))&&!A.includes(F))try{let v=s(a[F],d,{walkable:b,ignore:A});if(v)return v}catch{}}}}}return s(e,t,{walkable:o,ignore:n})}function H(e,t){return G(e,t,{walkable:["props","children","child","sibling"]})}var we={};E(we,{DISCORD_SERVER:()=>Se,GITHUB:()=>xe});var Se="https://discord.gg/n9QQ4XhhJP",xe="https://github.com/vendetta-mod";var Re={};E(Re,{Forms:()=>u,General:()=>J,Search:()=>Te});var u=l("Form","FormSection"),J=l("Button","Text","View"),Te=O("StaticSearchBarContainer");var Ie={};E(Ie,{showToast:()=>g});function g(e,t){return ge.open({content:e,source:t})}var w={};function Xe(){try{x("registerAsset",U,(e,t)=>{let o=e[0];w[o.name]={...o,id:t}});for(let e=1;;e++){let t=U.getAssetByID(e);if(!t)break;w[t.name]||(w[t.name]={...t,id:e})}}catch{}}var Qe=e=>Object.values(w).find(e),qe=e=>w[e],Ze=e=>U.getAssetByID(e),c=e=>w[e]?.id;function C(e,t){let o={},n={get(r,i){let s=Reflect.get(r,i);return typeof s=="object"&&s!==null?new Proxy(s,n):s},set(r,i,s){return Reflect.set(r,i,s),j.setItem(e,JSON.stringify(o)),!0},deleteProperty(r,i){return Reflect.deleteProperty(r,i),j.setItem(e,JSON.stringify(o)),!0}};return j.getItem(e).then(async function(r){if(!r)return;let i=JSON.parse(r);if(t&&typeof t=="function")t(i);else for(let s of Object.keys(i))o[s]=i[s]}),new Proxy(o,n)}var T=C("VENDETTA_SETTINGS");var{FormRow:I,FormSection:St,FormDivider:et}=u;function Pe({navigation:e}){return React.createElement(St,{key:"Vendetta",title:"Vendetta"},React.createElement(I,{label:"General",leading:()=>React.createElement(I.Icon,{source:c("settings")}),trailing:I.Arrow,onPress:()=>e.push("VendettaSettings")}),React.createElement(et,null),React.createElement(I,{label:"Plugins",leading:()=>React.createElement(I.Icon,{source:c("debug")}),trailing:I.Arrow,onPress:()=>e.push("VendettaPlugins")}),T.developerSettings&&React.createElement(React.Fragment,null,React.createElement(et,null),React.createElement(I,{label:"Developer",leading:()=>React.createElement(I.Icon,{source:c("ic_progress_wrench_24px")}),trailing:I.Arrow,onPress:()=>e.push("VendettaDeveloper")})))}var P;function ee(e){if(P!==void 0&&P.readyState!==WebSocket.CLOSED&&P.close(),e===""){g("Invalid debugger URL!",c("Small"));return}P=new WebSocket(`ws://${e}`),P.addEventListener("open",()=>g("Connected to debugger.",c("Check"))),P.addEventListener("message",t=>{try{(0,eval)(t.data)}catch(o){console.error(o)}}),P.addEventListener("error",t=>{console.log(`Debugger error: ${t.message}`),g("An error occurred with the debugger connection!",c("Small"))})}function tt(){x("nativeLoggingHook",globalThis,(e,t)=>{P?.readyState===WebSocket.OPEN&&P.send(JSON.stringify({message:e[0],level:e[1]})),h.log(e[0])})}var Ae="8a0f384";function ot(e=!1){let t=m.NativeModules.InfoDictionaryManager,o=window.HermesInternal.getRuntimeProperties(),n=m.Platform.constants,r=n.reactNativeVersion,i=m.NativeModules.DCDDeviceManager;return{vendetta:{version:Ae},discord:{version:t.Version,build:t.Build},react:{version:React.version,nativeVersion:`${r.major||0}.${r.minor||0}.${r.patch||0}`},hermes:{version:o["OSS Release Version"],buildType:o.Build,bytecodeVersion:o["Bytecode Version"]},...m.Platform.select({android:{os:{name:"Android",version:n.Release,sdk:n.Version}},ios:{os:{name:n.systemName,version:n.osVersion}}}),...m.Platform.select({android:{device:{manufacturer:n.Manufacturer,brand:n.Brand,model:n.Model,codename:i.device}},ios:{device:{manufacturer:i.deviceManufacturer,brand:i.deviceBrand,model:i.deviceModel,codename:i.device}}})}}var{FormRow:rt,FormText:xt}=u;function te({label:e,version:t,icon:o}){return React.createElement(rt,{label:e,leading:()=>React.createElement(rt.Icon,{source:c(o)}),trailing:()=>React.createElement(xt,null,t),onPress:()=>{_(`${e} - ${t}`),g("Copied version to clipboard.",c("toast_copy_link"))}})}var{FormRow:R,FormSwitchRow:wt,FormSection:oe,FormDivider:re}=u,f=ot();function De(){let[e,t]=React.useState(T.developerSettings||!1),o=[{label:"Vendetta",version:f.vendetta.version,icon:"ic_progress_wrench_24px"},{label:"Discord",version:`${f.discord.version} (${f.discord.build})`,icon:"Discord"},{label:"React",version:f.react.version,icon:"ic_category_16px"},{label:"React Native",version:f.react.nativeVersion,icon:"mobile"},{label:"Hermes",version:`${f.hermes.version} ${f.hermes.buildType} (Bytecode ${f.hermes.bytecodeVersion})`,icon:"ic_server_security_24px"}],n=[{label:"Operating System",version:`${f.os.name} ${f.os.version}`,icon:"ic_cog_24px"},...f.os.sdk?[{label:"SDK",version:f.os.sdk,icon:"ic_profile_badge_verified_developer_color"}]:[],{label:"Manufacturer",version:f.device.manufacturer,icon:"ic_hammer_and_chisel_24px"},{label:"Brand",version:f.device.brand,icon:"ic_settings_boost_24px"},{label:"Model",version:f.device.model,icon:"ic_phonelink_24px"},{label:m.Platform.select({android:"Codename",ios:"Machine ID"}),version:f.device.codename,icon:"ic_compose_24px"}];return React.createElement(m.ScrollView,null,React.createElement(oe,{title:"Links"},React.createElement(R,{label:"Discord Server",leading:React.createElement(R.Icon,{source:c("Discord")}),trailing:R.Arrow,onPress:()=>q.openURL(Se)}),React.createElement(re,null),React.createElement(R,{label:"GitHub",leading:React.createElement(R.Icon,{source:c("img_account_sync_github_white")}),trailing:R.Arrow,onPress:()=>q.openURL(xe)})),React.createElement(oe,{title:"Versions"},o.map(r=>React.createElement(React.Fragment,null,React.createElement(te,{label:r.label,version:r.version,icon:r.icon}),React.createElement(re,null)))),React.createElement(oe,{title:"Platform Info"},n.map(r=>React.createElement(React.Fragment,null,React.createElement(te,{label:r.label,version:r.version,icon:r.icon}),React.createElement(re,null)))),React.createElement(oe,{title:"Actions"},React.createElement(R,{label:"Reload Discord",leading:React.createElement(R.Icon,{source:c("ic_message_retry")}),trailing:R.Arrow,onPress:()=>m.NativeModules.BundleUpdaterManager.reload()}),React.createElement(re,null),React.createElement(wt,{label:"Developer Settings",leading:React.createElement(R.Icon,{source:c("ic_progress_wrench_24px")}),value:e,onValueChange:r=>{T.developerSettings=r,t(r)}})))}var k=p.createThemedStyleSheet({container:{backgroundColor:p.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},card:{backgroundColor:p.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:p.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:p.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:p.ThemeColorMap.HEADER_PRIMARY},headerTitle:{fontFamily:ue.Fonts.PRIMARY_BOLD,color:p.ThemeColorMap.HEADER_PRIMARY},backIcon:{tintColor:p.ThemeColorMap.INTERACTIVE_ACTIVE,marginLeft:15,marginRight:20}}),nt=ye.createStackNavigator(),{TouchableOpacity:Tt,Image:Rt}=J;function _e({plugin:e,children:t}){return React.createElement(be.NavigationContainer,null,React.createElement(nt.Navigator,{initialRouteName:e.manifest.name,style:k.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:k.card,headerStyle:k.header,headerTitleContainerStyle:k.headerTitleContainer}},React.createElement(nt.Screen,{name:e.manifest.name,component:t,options:{headerTitleStyle:k.headerTitle,headerLeft:()=>React.createElement(Tt,{onPress:()=>$.pop()},React.createElement(Rt,{style:k.backIcon,source:c("back-icon")}))}})))}var y=C("VENDETTA_PLUGINS",async function(e){for(let t of Object.keys(e)){let o=e[t];e[t].update?await Y(o.id):y[t]=e[t],e[t].enabled&&y[t]&&Fe(t)}}),N={};async function Y(e){if(e.endsWith("/")||(e+="/"),typeof e!="string"||e in y)throw new Error("Plugin ID invalid or taken");let t;try{t=await(await fetch(new URL("manifest.json",e),{cache:"no-store"})).json()}catch{throw new Error(`Failed to fetch manifest for ${e}`)}let o;try{o=await(await fetch(new URL(t.main||"index.js",e),{cache:"no-store"})).text()}catch{throw new Error(`Failed to fetch JS for ${e}`)}if(o.length===0)throw new Error(`Failed to fetch JS for ${e}`);y[e]={id:e,manifest:t,enabled:!1,update:!0,js:o}}function Ne(e){let t={...window.vendetta,plugin:{manifest:e.manifest,storage:C(e.id),showSettings:()=>Ee(e)}},o=`vendetta=>{return ${e.js}}
//# sourceURL=${e.id}`,n=(0,eval)(o)(t),r=typeof n=="function"?n():n;return r.default||r}function Fe(e){let t=y[e];if(!t)throw new Error("Attempted to start non-existent plugin");try{let o=Ne(t);N[e]=o,o.onLoad?.(),t.enabled=!0}catch(o){h.error(`Plugin ${t.id} errored whilst loading, and will be unloaded`,o);try{N[t.id]?.onUnload?.()}catch(n){h.error(`Plugin ${t.id} errored whilst unloading`,n)}delete N[e],t.enabled=!1}}function W(e){let t=y[e],o=N[e];if(!t)throw new Error("Attempted to stop non-existent plugin");if(!o)throw new Error("Attempted to stop a non-started plugin");try{N[t.id]?.onUnload?.()}catch(n){h.error(`Plugin ${t.id} errored whilst unloading`,n)}delete N[e],t.enabled=!1}function ne(e){y[e].enabled&&W(e),delete y[e]}var K=e=>N[e]?.settings;function Ee(e){let t=K(e.id);if(!t)return h.error(`Plugin ${e.id} is not loaded or has no settings`);$.push(_e,{plugin:e,children:t})}var{FormRow:Me,FormSwitch:It}=u,{TouchableOpacity:Oe,Image:Ce}=J,B=p.createThemedStyleSheet({card:{backgroundColor:p.ThemeColorMap.BACKGROUND_SECONDARY,borderRadius:5,margin:10},header:{backgroundColor:p.ThemeColorMap.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},icon:{width:22,height:22,marginLeft:5,tintColor:p.ThemeColorMap.INTERACTIVE_NORMAL}});function ke({plugin:e}){let[t,o]=React.useState(e.enabled),[n,r]=React.useState(e.update),[i,s]=React.useState(!1);return i?React.createElement(React.Fragment,null):React.createElement(m.View,{style:B.card},React.createElement(Me,{style:B.header,label:`${e.manifest.name} by ${e.manifest.authors.map(a=>a.name).join(", ")}`,leading:React.createElement(Me.Icon,{source:c(e.manifest.vendetta.icon||"ic_application_command_24px")}),trailing:React.createElement(It,{value:t,onValueChange:a=>{a?Fe(e.id):W(e.id),o(a)}})}),React.createElement(Me,{label:e.manifest.description,trailing:React.createElement(m.View,{style:B.actions},React.createElement(Oe,{onPress:()=>{ne(e.id),s(!0)}},React.createElement(Ce,{style:B.icon,source:c("ic_message_delete")})),React.createElement(Oe,{onPress:()=>{e.update=!e.update,g(`${e.update?"Enabled":"Disabled"} updates for ${e.manifest.name}.`,c("toast_image_saved")),r(e.update)}},React.createElement(Ce,{style:B.icon,source:c(n?"Check":"Small")})),K(e.id)&&React.createElement(Oe,{onPress:()=>Ee(e)},React.createElement(Ce,{style:B.icon,source:c("settings")})))}))}var{FormInput:Pt,FormRow:Be}=u;function Ve(){let[e,t]=React.useState(""),[o,n]=React.useState(y);return React.createElement(m.View,null,React.createElement(Pt,{value:e,onChange:r=>t(r),title:"PLUGIN URL"}),React.createElement(Be,{label:"Install plugin",leading:React.createElement(Be.Icon,{source:c("add_white")}),trailing:Be.Arrow,onPress:()=>{Y(e).then(()=>{t(""),n(y)}).catch(r=>{g(r.message,c("Small"))})}}),React.createElement(m.FlatList,{data:Object.values(o),renderItem:({item:r})=>React.createElement(ke,{plugin:r}),keyExtractor:r=>r.id}))}var{FormRow:At}=u,Dt=p.createThemedStyleSheet({asset:{width:32,height:32}});function Le({asset:e}){return React.createElement(At,{label:`${e.name} - ${e.id}`,trailing:()=>React.createElement(m.Image,{source:e.id,style:Dt.asset}),onPress:()=>{_(e.name),g("Copied asset name to clipboard.",c("toast_copy_link"))}})}var{FormSection:it,FormRow:V,FormInput:_t,FormDivider:Ue}=u,Nt=p.createThemedStyleSheet({search:{margin:0,padding:0,paddingRight:15,paddingLeft:15,borderBottomWidth:0,backgroundColor:"none"}});function $e(){let[e,t]=React.useState(T.debuggerUrl||""),[o,n]=React.useState("");return React.createElement(m.View,null,React.createElement(it,{title:"Debug"},React.createElement(_t,{value:e,onChange:r=>{T.debuggerUrl=r,t(r)},title:"DEBUGGER URL"}),React.createElement(Ue,null),React.createElement(V,{label:"Connect to debug websocket",leading:()=>React.createElement(V.Icon,{source:c("copy")}),trailing:V.Arrow,onPress:()=>ee(e)}),React.createElement(Ue,null),window.__vendetta_rdc&&React.createElement(V,{label:"Connect to React DevTools",leading:()=>React.createElement(V.Icon,{source:c("ic_badge_staff")}),trailing:V.Arrow,onPress:()=>{try{window.__vendetta_rdc?.connectToDevTools({host:e.split(":")[0],resolveRNStyle:m.StyleSheet.flatten})}catch(r){h.error("Failed to connect to React DevTools!",r),g("Failed to connect to React DevTools!",c("Small"))}}})),React.createElement(it,{title:"Assets"},React.createElement(Te,{style:Nt.search,onChangeText:r=>n(r),placeholder:"Search..."}),React.createElement(m.FlatList,{data:Object.values(w).filter(r=>r.name.includes(o)),renderItem:({item:r})=>React.createElement(React.Fragment,null,React.createElement(Le,{asset:r}),React.createElement(Ue,null)),keyExtractor:r=>r.name})))}var Ft=O("getScreens",!1),Et=O("UserSettingsOverviewWrapper",!1),ie=[];function je(){x("default",Ft,(e,t)=>({...t,VendettaSettings:{title:"Vendetta",render:De},VendettaPlugins:{title:"Plugins",render:Ve},VendettaDeveloper:{title:"Developer",render:$e}})),x("default",Et,(e,t)=>{for(let n of ie)n();ie=[];let o=H(t.props.children,n=>n.type&&n.type.name==="UserSettingsOverview");ie.push(x("renderSupportAndAcknowledgements",o.type.prototype,(n,{props:{children:r}})=>{let i=r.findIndex(s=>s?.type?.name==="UploadLogsButton");i!==-1&&r.splice(i,1)})),ie.push(x("render",o.type.prototype,(n,{props:{children:r}})=>{let i=[Q.Messages.BILLING_SETTINGS,Q.Messages.PREMIUM_SETTINGS],s=r.findIndex(a=>i.includes(a.props.title));r.splice(s===-1?4:s,0,React.createElement(Pe,{navigation:o.props.navigation}))}))})}var Mt=l("updateTheme","overrideTheme"),st=l("setAMOLEDThemeEnabled"),at=X("ThemeStore"),Ot=X("UnsyncedUserSettingsStore");function ct(){try{if(at){let t=function(){let o=at.theme||"dark";Mt.overrideTheme(o),st&&Ot.useAMOLEDTheme===2&&st.setAMOLEDThemeEnabled(!0),Z.unsubscribe("I18N_LOAD_START",t)};var e=t;Z.subscribe("I18N_LOAD_START",t)}}catch(t){h.error("Failed to fix theme...",t)}}console.log("Hello from Vendetta!");async function Ct(){let e=!1;try{window.vendetta={patcher:Je,metro:{...fe,common:{...ve}},constants:{...we},utils:{copyText:_,findInReactTree:H,findInTree:G},debug:{connectToDebugger:ee},ui:{components:{...Re},toasts:{...Ie},assets:{all:w,find:Qe,getAssetByID:Ze,getAssetByName:qe,getAssetIDByName:c}},plugins:{plugins:y,fetchPlugin:Y,evalPlugin:Ne,stopPlugin:W,removePlugin:ne,getSettings:K},settings:T,logger:h,version:Ae},tt(),Xe(),ct(),je()}catch(t){e=!0,alert(`Vendetta failed to initialize... ${t.stack||t.toString()}`)}e||h.log("Vendetta is ready!")}Ct();})();
//# sourceURL=Vendetta